import"./main--IH-ptLw.js";import{m as L}from"./maplibre-gl-DtRcNtl7.js";document.title="üó≥Ô∏è Political Regime";class D{constructor(){this.container=null,this.overlay=null,this.currentNotification=null,this.init()}init(){this.overlay=document.createElement("div"),this.overlay.className="notification-overlay",document.body.appendChild(this.overlay),this.container=document.createElement("div"),this.container.className="notification-container",document.body.appendChild(this.container)}show(t){this.currentNotification&&this.hide();const{type:i="success",title:a="",message:o="",stats:r=null,duration:d=null,onClose:b=null}=t,f=document.createElement("div");f.className=`notification ${i}`;let m=`
            <div class="notification-icon">${{success:"üéâ",warning:"‚è∞",error:"‚ùå"}[i]}</div>
            <div class="notification-title">${a}</div>
            <div class="notification-message">${o}</div>
        `;r&&(m+='<div class="notification-stats">',r.forEach($=>{m+=`
                    <div class="stat-item">
                        <span class="stat-value">${$.value}</span>
                        <span class="stat-label">${$.label}</span>
                    </div>
                `}),m+="</div>"),m+='<button class="notification-button" onclick="gameNotification.hide()">Continue</button>',f.innerHTML=m,this.container.appendChild(f),this.currentNotification=f,this.overlay.classList.add("show"),f.classList.add("show"),d&&setTimeout(()=>this.hide(),d),this.onCloseCallback=b}hide(){this.currentNotification&&(this.overlay.classList.remove("show"),this.overlay.classList.add("hide"),this.currentNotification.classList.remove("show"),this.currentNotification.classList.add("hide"),setTimeout(()=>{this.currentNotification&&(this.container.removeChild(this.currentNotification),this.currentNotification=null),this.overlay.classList.remove("hide"),this.onCloseCallback&&(this.onCloseCallback(),this.onCloseCallback=null)},400))}formatTime(t){const i=Math.floor(t/60),a=t%60;return`${i.toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`}}window.gameNotification=new D;function w(){switch(g){case"30 seconds":l=30;break;case"1 minute":l=60;break;case"2 minutes":l=120;break;case"3 minutes":l=180;break;case"4 minutes":l=240;break;case"5 minutes":l=300;break;default:l=120}return l}const E=document.querySelector(".heading"),F=document.querySelector(".top-info-bar .counter"),T=document.querySelector(".top-info-bar .timer"),p=document.getElementById("startButton"),y=document.getElementById("endButton");let g,I;const k=localStorage.getItem("gameSettings");if(k===null)g="30 seconds";else try{g=JSON.parse(k).Timer||"30 seconds"}catch(s){console.error("Error parsing gameSettings from localStorage:",s),g="30 seconds"}var e=new L.Map({container:"map",style:"https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json",center:[80,30],zoom:1,maxZoom:5,attributionControl:!1,renderWorldCopies:!1});let h=[],n=null,u=0,l,S=new Set,v=!1,c=null;p.disabled=!0;y.disabled=!0;w();fetch("/democracy-game/assets/data/wm2.geojson").then(s=>s.json()).then(s=>{const t={};s.features.forEach(i=>{if(i.properties){for(const a in i.properties)if(a.startsWith("Political_")){const o=i.properties[a].trim();o!==null&&o!=="N/A"&&(t[a]||(t[a]={}),t[a][o]||(t[a][o]=0),t[a][o]++)}}});for(const i in t)for(const a in t[i])t[i][a]>0&&h.push({propertyKey:i,systemValue:a,count:t[i][a]});h.length>0&&(p.disabled=!1),e.on("load",()=>{const i=e.getStyle();i&&i.layers&&i.layers.filter(r=>r.type==="symbol").map(r=>r.id).forEach(r=>{e.getLayer(r)&&e.removeLayer(r)}),e.setPaintProperty("water","fill-color","#342F33"),e.addSource("countries",{type:"geojson",data:s,promoteId:"ADMIN"}),e.addLayer({id:"countries-layer",type:"fill",source:"countries",paint:{"fill-color":["case",["boolean",["feature-state","incorrect_click"],!1],"#FF3860",["boolean",["feature-state","clicked"],!1],"#47E18D","#FFEEE2"],"fill-opacity":["case",["boolean",["feature-state","incorrect_click"],!1],.9,["boolean",["feature-state","clicked"],!1],.8,["boolean",["feature-state","hover"],!1],1,.9],"fill-outline-color":"#342F33"}}),e.addLayer({id:"countries-lines",type:"line",source:"countries",layout:{},paint:{"line-color":"#342F33","line-width":["case",["boolean",["feature-state","clicked"],!1],1,["boolean",["feature-state","hover"],!1],1.5,.5]}}),s.features.forEach(o=>{o.properties&&o.properties.ADMIN&&e.setFeatureState({source:"countries",id:o.properties.ADMIN},{hover:!1,clicked:!1,incorrect_click:!1})});const a=new L.Popup({className:"custom-country-popup",closeButton:!1,closeOnClick:!1});e.on("mousemove","countries-layer",o=>{if(o.features.length>0){const r=o.features[0].id;e.getCanvas().style.cursor="pointer",c!==null&&c!==r&&e.setFeatureState({source:"countries",id:c},{hover:!1}),e.setFeatureState({source:"countries",id:r},{hover:!0}),c=r;const d=o.features[0].properties.ADMIN;a.setLngLat(o.lngLat).setHTML(d).addTo(e)}else e.getCanvas().style.cursor="",c!==null&&(e.setFeatureState({source:"countries",id:c},{hover:!1}),c=null),a.remove()}),e.on("mouseleave","countries-layer",()=>{e.getCanvas().style.cursor="",c!==null&&(e.setFeatureState({source:"countries",id:c},{hover:!1}),c=null),a.remove()}),e.on("click","countries-layer",o=>{if(v&&o.features.length>0){const r=o.features[0],d=r.properties.ADMIN;if(S.has(d))return;if(r.properties[n.propertyKey]===n.systemValue)u++,S.add(d),e.setFeatureState({source:"countries",id:d},{clicked:!0,hover:!1}),c===d&&(c=null),M(),u===n.count&&N(!0);else{const b=d;e.setFeatureState({source:"countries",id:b},{incorrect_click:!0})}}})})}).catch(s=>console.error("failed to load geojson",s));function C(){const s=Math.floor(l/60),t=l%60;T.textContent=`${s.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`}function M(){F.textContent=`${u.toString().padStart(2,"0")}/${n.count.toString().padStart(2,"0")}`}function x(){if(w(),h.length===0){gameNotification.show({type:"error",title:"No Challenges",message:"No game challenges available to start the game."});return}v=!0,p.disabled=!0,y.disabled=!1,e.getSource("countries")&&e.removeFeatureState({source:"countries"}),S.clear(),c=null;const s=Math.floor(Math.random()*h.length);n=h[s],u=0,E.textContent=`${n.systemValue.toUpperCase()}`,M(),C(),I=setInterval(()=>{l--,C(),l<=0&&N(!1)},1e3)}function N(s=!1){if(clearInterval(I),v=!1,p.disabled=!1,y.disabled=!0,s)gameNotification.show({type:"success",title:"Perfect Score!",message:`Congratulations! You found all ${n.count} ${n.systemValue.toLowerCase()} countries!`,stats:[{value:`${u}/${n.count}`,label:"Found"},{value:"100%",label:"Score"},{value:gameNotification.formatTime(l),label:"Time Left"}]});else if(l<=0){const t=Math.round(u/n.count*100);gameNotification.show({type:"error",title:"Time's Up!",message:`You found ${u} out of ${n.count} ${n.systemValue.toLowerCase()} countries`,stats:[{value:`${u}/${n.count}`,label:"Found"},{value:`${t}%`,label:"Final Score"},{value:"00:00",label:"Time Left"}]})}else{const t=Math.round(u/n.count*100);gameNotification.show({type:"warning",title:"Game Ended",message:`You found ${u} out of ${n.count} ${n.systemValue.toLowerCase()} countries`,stats:[{value:`${u}/${n.count}`,label:"Found"},{value:`${t}%`,label:"Score"},{value:gameNotification.formatTime(l),label:"Time Left"}]})}setTimeout(()=>{E.textContent="SYSTEM TYPE",F.textContent="00/00",T.textContent="00:00"},100)}p.addEventListener("click",x);y.addEventListener("click",()=>{v&&N(!1)});window.addEventListener("resize",function(){e&&e.resize()});C();
